---
title: "Google Maps Popular Times Analysis"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```

```{r functions}
filter_poi <- function(type) {
  max_level <- 2
  return(poptimes %>% filter(poptimes[type] != 0 & poptimes[type] <= max_level))
}

normalize <- function(x) {
  return( (x - min(x) ) / ( max(x) - min(x) ) * 100)
}

summarize_hours <- function(input, func=mean) {
  df <- input[,(ncol(input)-(168-1)):ncol(input)]
  df <- as.data.frame(t(df %>% summarize_each(funs(func))))
  df$hour <- 1:nrow(df)
  colnames(df) <- c("popularity", "hour")
  df <- df %>% relocate(hour, .before = popularity)
  df$popularity <- normalize(df$popularity)
  return(df)
}
```

```{r readdata}
poptimes <- read_csv("tidy-places.csv")
poi <- c("bar", "restaurant", "supermarket", "church", "gym", "shopping_mall", "store", "department_store")

filtered <- lapply(poi, filter_poi)

bar <- as.data.frame(filtered[match("bar", poi)])
restaurant <- as.data.frame(filtered[match("restaurant", poi)])
supermarket <- as.data.frame(filtered[match("supermarket", poi)])
gym <- as.data.frame(filtered[match("gym", poi)])
shopping_mall <- as.data.frame(filtered[match("shopping_mall", poi)])
department_store <- as.data.frame(filtered[match("department_store", poi)])
store <- union(shopping_mall, department_store)
```

```{r plots}

weekly <- function(input) {
  return(ggplot(data = input, mapping = aes(x=hour, y=popularity)) + geom_bar(stat="identity", fill="gray50") + theme_minimal())
}

weekly(summarize_hours(bar, mean))
weekly(summarize_hours(restaurant, mean))
weekly(summarize_hours(supermarket, mean))
weekly(summarize_hours(gym, mean))
weekly(summarize_hours(shopping_mall, mean))
weekly(summarize_hours(department_store, mean))
weekly(summarize_hours(store, mean))


```