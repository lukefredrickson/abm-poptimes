return(tidy_places)
}
tidy_places <- lapply(places_json, tidy_places_json)
View(places_json)
tidy_places_json <- function(places_json) {
spread <- as.data.frame(places_json %>% spread_all %>% select(array.index, id, name, address)) %>% select(!c(..JSON))
times <- places %>% enter_object(populartimes) %>% gather_array %>% enter_object(data) %>% gather_array %>% append_values_number("value") %>% select(!c(document.id))
times_wide <- as.data.frame(times) %>% select(!c(..JSON)) %>% pivot_wider(names_from = c(array.index.2, array.index.3), values_from = value)
time_spent <- places %>% enter_object(time_spent) %>% gather_array %>% append_values_number("value") %>% select(!c(document.id))
time_spent_wide <- as.data.frame(time_spent) %>% select(!c(..JSON)) %>% pivot_wider(names_from = array.index.2, names_prefix="time.spent.", values_from = value)
types <- places %>% enter_object(types) %>% gather_array() %>% append_values_string("type") %>% select(!c(document.id))
types_wide <- as.data.frame(types) %>% select(!c(..JSON)) %>% pivot_wider(names_from = array.index.2, names_prefix="type.", values_from = type)
tidy_places <- spread %>% left_join(types_wide, by="array.index") %>% left_join(time_spent_wide, by="array.index") %>% left_join(ticmes_wide, by="array.index") %>% select(-c(array.index))
return(tidy_places)
}
tidy_places <- lapply(places_json, tidy_places_json)
return(tidy_places)
tidy_places_json <- function(places_json) {
spread <- as.data.frame(places_json %>% spread_all %>% select(array.index, id, name, address)) %>% select(!c(..JSON))
times <- places_json %>% enter_object(populartimes) %>% gather_array %>% enter_object(data) %>% gather_array %>% append_values_number("value") %>% select(!c(document.id))
times_wide <- as.data.frame(times) %>% select(!c(..JSON)) %>% pivot_wider(names_from = c(array.index.2, array.index.3), values_from = value)
time_spent <- places_json %>% enter_object(time_spent) %>% gather_array %>% append_values_number("value") %>% select(!c(document.id))
time_spent_wide <- as.data.frame(time_spent) %>% select(!c(..JSON)) %>% pivot_wider(names_from = array.index.2, names_prefix="time.spent.", values_from = value)
types <- places_json %>% enter_object(types) %>% gather_array() %>% append_values_string("type") %>% select(!c(document.id))
types_wide <- as.data.frame(types) %>% select(!c(..JSON)) %>% pivot_wider(names_from = array.index.2, names_prefix="type.", values_from = type)
tidy_places <- spread %>% left_join(types_wide, by="array.index") %>% left_join(time_spent_wide, by="array.index") %>% left_join(ticmes_wide, by="array.index") %>% select(-c(array.index))
return(tidy_places)
}
tidy_places <- lapply(places_json, tidy_places_json)
tidy_places <- spread %>% left_join(types_wide, by="array.index") %>% left_join(time_spent_wide, by="array.index") %>% left_join(times_wide, by="array.index") %>% select(-c(array.index))
return(tidy_places)
tidy_places_json <- function(places_json) {
spread <- as.data.frame(places_json %>% spread_all %>% select(array.index, id, name, address)) %>% select(!c(..JSON))
times <- places_json %>% enter_object(populartimes) %>% gather_array %>% enter_object(data) %>% gather_array %>% append_values_number("value") %>% select(!c(document.id))
times_wide <- as.data.frame(times) %>% select(!c(..JSON)) %>% pivot_wider(names_from = c(array.index.2, array.index.3), values_from = value)
time_spent <- places_json %>% enter_object(time_spent) %>% gather_array %>% append_values_number("value") %>% select(!c(document.id))
time_spent_wide <- as.data.frame(time_spent) %>% select(!c(..JSON)) %>% pivot_wider(names_from = array.index.2, names_prefix="time.spent.", values_from = value)
types <- places_json %>% enter_object(types) %>% gather_array() %>% append_values_string("type") %>% select(!c(document.id))
types_wide <- as.data.frame(types) %>% select(!c(..JSON)) %>% pivot_wider(names_from = array.index.2, names_prefix="type.", values_from = type)
tidy_places <- spread %>% left_join(types_wide, by="array.index") %>% left_join(time_spent_wide, by="array.index") %>% left_join(times_wide, by="array.index") %>% select(-c(array.index))
return(tidy_places)
}
tidy_places <- lapply(places_json, tidy_places_json)
View(tidy_places)
bar <- as.data.frame(tidy_places)
bar <- as.data.frame(tidy_places)
View(tidy_places)
bar <- as.data.frame(tidy_places[1])
View(bar)
View(bar)
tidy_places_json <- function(places_json) {
spread <- as.data.frame(places_json %>% spread_all %>% select(array.index, id, name, address)) %>% select(!c(..JSON))
print(spread)
times <- places_json %>% enter_object(populartimes) %>% gather_array %>% enter_object(data) %>% gather_array %>% append_values_number("value") %>% select(!c(document.id))
times_wide <- as.data.frame(times) %>% select(!c(..JSON)) %>% pivot_wider(names_from = c(array.index.2, array.index.3), values_from = value)
time_spent <- places_json %>% enter_object(time_spent) %>% gather_array %>% append_values_number("value") %>% select(!c(document.id))
time_spent_wide <- as.data.frame(time_spent) %>% select(!c(..JSON)) %>% pivot_wider(names_from = array.index.2, names_prefix="time.spent.", values_from = value)
types <- places_json %>% enter_object(types) %>% gather_array() %>% append_values_string("type") %>% select(!c(document.id))
types_wide <- as.data.frame(types) %>% select(!c(..JSON)) %>% pivot_wider(names_from = array.index.2, names_prefix="type.", values_from = type)
tidy_places <- spread %>% left_join(types_wide, by="array.index") %>% left_join(time_spent_wide, by="array.index") %>% left_join(times_wide, by="array.index") %>% select(-c(array.index))
return(tidy_places)
}
tidy_places <- lapply(places_json, tidy_places_json)
tidy_places_json <- function(places_json) {
spread <- as.data.frame(places_json %>%
spread_all %>%
select(array.index, id, name, address)) %>%
select(!c(..JSON))
print(spread)
times <- places_json %>%
enter_object(populartimes) %>%
gather_array %>%
enter_object(data) %>%
gather_array %>%
append_values_number("value") %>%
select(!c(document.id))
times_wide <- as.data.frame(times) %>%
select(!c(..JSON)) %>%
pivot_wider(names_from = c(array.index.2, array.index.3), values_from = value)
time_spent <- places_json %>%
enter_object(time_spent) %>%
gather_array %>%
append_values_number("value") %>%
select(!c(document.id))
time_spent_wide <- as.data.frame(time_spent) %>%
select(!c(..JSON)) %>%
pivot_wider(names_from = array.index.2, names_prefix="time.spent.", values_from = value)
types <- places_json %>%
enter_object(types) %>%
gather_array() %>%
append_values_string("type") %>%
select(!c(document.id))
types_wide <- as.data.frame(types) %>%
select(!c(..JSON)) %>%
pivot_wider(names_from = array.index.2, names_prefix="type.", values_from = type)
tidy_places <- spread %>%
left_join(types_wide, by="array.index") %>%
left_join(time_spent_wide, by="array.index") %>%
left_join(times_wide, by="array.index") %>% select(-c(array.index))
return(tidy_places)
}
tidy_places <- lapply(places_json, tidy_places_json)
bar <- as.data.frame(tidy_places)
bar <- as.data.frame(tidy_places[1])
View(tidy_places)
View(tidy_places)
tidy_places_json <- function(places_json) {
spread <- as.data.frame(places_json %>%
spread_all %>%
select(array.index, id, name, address)) %>%
select(!c(..JSON))
print(spread)
times <- places_json %>%
enter_object(populartimes) %>%
gather_array %>%
enter_object(data) %>%
gather_array %>%
append_values_number("value") %>%
select(!c(document.id))
times_wide <- as.data.frame(times) %>%
select(!c(..JSON)) %>%
pivot_wider(names_from = c(array.index.2, array.index.3), values_from = value)
time_spent <- places_json %>%
enter_object(time_spent) %>%
gather_array %>%
append_values_number("value") %>%
select(!c(document.id))
time_spent_wide <- as.data.frame(time_spent) %>%
select(!c(..JSON)) %>%
pivot_wider(names_from = array.index.2, names_prefix="time.spent.", values_from = value)
type_names <- c("bar", "supermarket", "church", "gym", "restaurant", "shopping_mall", "store", "department_store")
types_df <- data.frame(type_names)
types <- places_json %>%
enter_object(types) %>%
gather_array() %>%
append_values_string("type") %>%
select(!c(document.id))
types_wide <- as.data.frame(types) %>%
select(!c(..JSON)) %>%
pivot_wider(names_from = array.index.2, names_prefix="type.", values_from = type)
tidy_places <- spread %>%
left_join(types_wide, by="array.index") %>%
left_join(time_spent_wide, by="array.index") %>%
left_join(times_wide, by="array.index") %>% select(-c(array.index))
return(tidy_places)
}
tidy_places <- lapply(places_json, tidy_places_json)
View(tidy_places_json)
tidy_places_json <- function(places_json) {
spread <- as.data.frame(places_json %>%
spread_all %>%
select(array.index, id, name, address)) %>%
select(!c(..JSON))
print(spread)
times <- places_json %>%
enter_object(populartimes) %>%
gather_array %>%
enter_object(data) %>%
gather_array %>%
append_values_number("value") %>%
select(!c(document.id))
times_wide <- as.data.frame(times) %>%
select(!c(..JSON)) %>%
pivot_wider(names_from = c(array.index.2, array.index.3), values_from = value)
time_spent <- places_json %>%
enter_object(time_spent) %>%
gather_array %>%
append_values_number("value") %>%
select(!c(document.id))
time_spent_wide <- as.data.frame(time_spent) %>%
select(!c(..JSON)) %>%
pivot_wider(names_from = array.index.2, names_prefix="time.spent.", values_from = value)
type_names <- c("bar", "supermarket", "church", "gym", "restaurant", "shopping_mall", "store", "department_store")
types_df <- data.frame(type_names)
types <- places_json %>%
enter_object(types) %>%
gather_array() %>%
append_values_string("type") %>%
select(!c(document.id))
types_wide <- as.data.frame(types) %>%
select(!c(..JSON)) %>%
pivot_wider(names_from = array.index.2, names_prefix="type.", values_from = type)
tidy_places <- spread %>%
left_join(types_wide, by="array.index") %>%
left_join(time_spent_wide, by="array.index") %>%
left_join(times_wide, by="array.index") %>% select(-c(array.index))
return(tidy_places)
}
library(tidyverse)
library(tidyjson)
read_places_json <- function(place_type) {
filename <- paste("btv-", place_type, ".json", sep="")
return(read_json(filename) %>% gather_array)
}
places <- c("bar", "cafe", "restaurant")
places_json <- lapply(places, read_places_json)
tidy_places_json <- function(places_json) {
spread <- as.data.frame(places_json %>%
spread_all %>%
select(array.index, id, name, address)) %>%
select(!c(..JSON))
print(spread)
times <- places_json %>%
enter_object(populartimes) %>%
gather_array %>%
enter_object(data) %>%
gather_array %>%
append_values_number("value") %>%
select(!c(document.id))
times_wide <- as.data.frame(times) %>%
select(!c(..JSON)) %>%
pivot_wider(names_from = c(array.index.2, array.index.3), values_from = value)
time_spent <- places_json %>%
enter_object(time_spent) %>%
gather_array %>%
append_values_number("value") %>%
select(!c(document.id))
time_spent_wide <- as.data.frame(time_spent) %>%
select(!c(..JSON)) %>%
pivot_wider(names_from = array.index.2, names_prefix="time.spent.", values_from = value)
type_names <- c("bar", "supermarket", "church", "gym", "restaurant", "shopping_mall", "store", "department_store")
types_df <- data.frame(type_names)
types <- places_json %>%
enter_object(types) %>%
gather_array() %>%
append_values_string("type") %>%
select(!c(document.id))
types_wide <- as.data.frame(types) %>%
select(!c(..JSON)) %>%
pivot_wider(names_from = array.index.2, names_prefix="type.", values_from = type)
tidy_places <- spread %>%
left_join(types_wide, by="array.index") %>%
left_join(time_spent_wide, by="array.index") %>%
left_join(times_wide, by="array.index") %>% select(-c(array.index))
return(tidy_places)
}
tidy_places <- lapply(places_json, tidy_places_json)
bar <- as.data.frame(tidy_places[1])
debugSource('~/code/abm-poptimes/poptimes.R')
time_spent_wide <- as.data.frame(time_spent) %>%
select(!c(..JSON)) %>%
pivot_wider(names_from = array.index.2, names_prefix="time.spent.", values_from = value)
library(tidyverse)
library(tidyjson)
read_places_json <- function(place_type) {
filename <- paste("btv-", place_type, ".json", sep="")
return(read_json(filename) %>% gather_array)
}
places <- c("bar", "cafe", "restaurant")
places_json <- lapply(places, read_places_json)
tidy_places_json <- function(places_json) {
spread <- as.data.frame(places_json %>%
spread_all %>%
select(array.index, id, name, address)) %>%
select(!c(..JSON))
print(spread)
times <- places_json %>%
enter_object(populartimes) %>%
gather_array %>%
enter_object(data) %>%
gather_array %>%
append_values_number("value") %>%
select(!c(document.id))
times_wide <- as.data.frame(times) %>%
select(!c(..JSON)) %>%
pivot_wider(names_from = c(array.index.2, array.index.3), values_from = value)
time_spent <- places_json %>%
enter_object(time_spent) %>%
gather_array %>%
append_values_number("value") %>%
select(!c(document.id))
time_spent_wide <- as.data.frame(time_spent) %>%
select(!c(..JSON)) %>%
pivot_wider(names_from = array.index.2, names_prefix="time.spent.", values_from = value)
type_names <- c("bar", "supermarket", "church", "gym", "restaurant", "shopping_mall", "store", "department_store")
types_df <- data.frame(type_names)
types <- places_json %>%
enter_object(types) %>%
gather_array() %>%
append_values_string("type") %>%
select(!c(document.id))
types_wide <- as.data.frame(types) %>%
select(!c(..JSON)) %>%
pivot_wider(names_from = array.index.2, names_prefix="type.", values_from = type)
tidy_places <- spread %>%
left_join(types_wide, by="array.index") %>%
left_join(time_spent_wide, by="array.index") %>%
left_join(times_wide, by="array.index") %>% select(-c(array.index))
return(tidy_places)
}
tidy_places <- lapply(places_json, tidy_places_json)
bar <- as.data.frame(tidy_places[1])
library(tidyverse)
library(tidyjson)
read_places_json <- function(place_type) {
filename <- paste("btv-", place_type, ".json", sep="")
return(read_json(filename) %>% gather_array)
}
places <- c("bar", "cafe", "restaurant")
places_json <- lapply(places, read_places_json)
tidy_places_json <- function(places_json) {
spread <- as.data.frame(places_json %>%
spread_all %>%
select(array.index, id, name, address)) %>%
select(!c(..JSON))
print(spread)
times <- places_json %>%
enter_object(populartimes) %>%
gather_array %>%
enter_object(data) %>%
gather_array %>%
append_values_number("value") %>%
select(!c(document.id))
times_wide <- as.data.frame(times) %>%
select(!c(..JSON)) %>%
pivot_wider(names_from = c(array.index.2, array.index.3), values_from = value)
time_spent <- places_json %>%
enter_object(time_spent) %>%
gather_array %>%
append_values_number("value") %>%
select(!c(document.id))
time_spent_wide <- as.data.frame(time_spent) %>%
select(!c(..JSON)) %>%
pivot_wider(names_from = array.index.2, names_prefix="time.spent.", values_from = value)
type_names <- c("bar", "supermarket", "church", "gym", "restaurant", "shopping_mall", "store", "department_store")
types_df <- data.frame(type_names)
types <- places_json %>%
enter_object(types) %>%
gather_array() %>%
append_values_string("type") %>%
select(!c(document.id))
types_wide <- as.data.frame(types) %>%
select(!c(..JSON)) %>%
pivot_wider(names_from = array.index.2, names_prefix="type.", values_from = type)
tidy_places <- spread %>%
left_join(types_wide, by="array.index") %>%
left_join(time_spent_wide, by="array.index") %>%
left_join(times_wide, by="array.index") %>% select(-c(array.index))
return(tidy_places)
}
tidy_places <- lapply(places_json, tidy_places_json)
bar <- as.data.frame(tidy_places[1])
debugSource('~/code/abm-poptimes/poptimes.R')
View(types)
debugSource('~/code/abm-poptimes/poptimes.R')
debugSource('~/code/abm-poptimes/poptimes.R')
debugSource('~/code/abm-poptimes/poptimes.R')
debugSource('~/code/abm-poptimes/poptimes.R')
library(tidyverse)
library(tidyjson)
read_places_json <- function(place_type) {
filename <- paste("btv-", place_type, ".json", sep="")
return(read_json(filename) %>% gather_array)
}
places <- c("bar", "cafe", "restaurant")
places_json <- lapply(places, read_places_json)
tidy_places_json <- function(places_json) {
spread <- as.data.frame(places_json %>%
spread_all %>%
select(array.index, id, name, address)) %>%
select(!c(..JSON))
print(spread)
times <- places_json %>%
enter_object(populartimes) %>%
gather_array %>%
enter_object(data) %>%
gather_array %>%
append_values_number("value") %>%
select(!c(document.id))
times_wide <- as.data.frame(times) %>%
select(!c(..JSON)) %>%
pivot_wider(names_from = c(array.index.2, array.index.3), values_from = value)
time_spent <- places_json %>%
enter_object(time_spent) %>%
gather_array %>%
append_values_number("value") %>%
select(!c(document.id))
time_spent_wide <- as.data.frame(time_spent) %>%
select(!c(..JSON)) %>%
pivot_wider(names_from = array.index.2, names_prefix="time.spent.", values_from = value)
type_names <- c("bar", "supermarket", "church", "gym", "restaurant", "shopping_mall", "store", "department_store")
cbind(spread, type_names)
types <- places_json %>%
enter_object(types) %>%
gather_array() %>%
append_values_string("type") %>%
select(!c(document.id))
types_wide <- as.data.frame(types) %>%
select(!c(..JSON)) %>%
pivot_wider(names_from = array.index.2, names_prefix="type.", values_from = type)
tidy_places <- spread %>%
left_join(types_wide, by="array.index") %>%
left_join(time_spent_wide, by="array.index") %>%
left_join(times_wide, by="array.index") %>% select(-c(array.index))
return(tidy_places)
}
tidy_places <- lapply(places_json, tidy_places_json)
bar <- as.data.frame(tidy_places[1])
library(tidyverse)
library(tidyjson)
read_places_json <- function(place_type) {
filename <- paste("btv-", place_type, ".json", sep="")
return(read_json(filename) %>% gather_array)
}
places <- c("bar", "cafe", "restaurant")
places_json <- lapply(places, read_places_json)
tidy_places_json <- function(places_json) {
spread <- as.data.frame(places_json %>%
spread_all %>%
select(array.index, id, name, address)) %>%
select(!c(..JSON))
print(spread)
times <- places_json %>%
enter_object(populartimes) %>%
gather_array %>%
enter_object(data) %>%
gather_array %>%
append_values_number("value") %>%
select(!c(document.id))
times_wide <- as.data.frame(times) %>%
select(!c(..JSON)) %>%
pivot_wider(names_from = c(array.index.2, array.index.3), values_from = value)
time_spent <- places_json %>%
enter_object(time_spent) %>%
gather_array %>%
append_values_number("value") %>%
select(!c(document.id))
time_spent_wide <- as.data.frame(time_spent) %>%
select(!c(..JSON)) %>%
pivot_wider(names_from = array.index.2, names_prefix="time.spent.", values_from = value)
type_names <- c("bar", "supermarket", "church", "gym", "restaurant", "shopping_mall", "store", "department_store")
cbind(spread, type_names)
types <- places_json %>%
enter_object(types) %>%
gather_array() %>%
append_values_string("type") %>%
select(!c(document.id))
types_wide <- as.data.frame(types) %>%
select(!c(..JSON)) %>%
pivot_wider(names_from = array.index.2, names_prefix="type.", values_from = type)
tidy_places <- spread %>%
left_join(types_wide, by="array.index") %>%
left_join(time_spent_wide, by="array.index") %>%
left_join(times_wide, by="array.index") %>% select(-c(array.index))
return(tidy_places)
}
tidy_places <- lapply(places_json, tidy_places_json)
bar <- as.data.frame(tidy_places[1])
library(tidyverse)
library(tidyjson)
read_places_json <- function(place_type) {
filename <- paste("btv-", place_type, ".json", sep="")
return(read_json(filename) %>% gather_array)
}
places <- c("bar", "cafe", "restaurant")
places_json <- lapply(places, read_places_json)
tidy_places_json <- function(places_json) {
spread <- as.data.frame(places_json %>%
spread_all %>%
select(array.index, id, name, address)) %>%
select(!c(..JSON))
print(spread)
times <- places_json %>%
enter_object(populartimes) %>%
gather_array %>%
enter_object(data) %>%
gather_array %>%
append_values_number("value") %>%
select(!c(document.id))
times_wide <- as.data.frame(times) %>%
select(!c(..JSON)) %>%
pivot_wider(names_from = c(array.index.2, array.index.3), values_from = value)
time_spent <- places_json %>%
enter_object(time_spent) %>%
gather_array %>%
append_values_number("value") %>%
select(!c(document.id))
time_spent_wide <- as.data.frame(time_spent) %>%
select(!c(..JSON)) %>%
pivot_wider(names_from = array.index.2, names_prefix="time.spent.", values_from = value)
type_names <- c("bar", "supermarket", "church", "gym", "restaurant", "shopping_mall", "store", "department_store")
spread[type_names] <- 0
types <- places_json %>%
enter_object(types) %>%
gather_array() %>%
append_values_string("type") %>%
select(!c(document.id))
types_wide <- as.data.frame(types) %>%
select(!c(..JSON)) %>%
pivot_wider(names_from = array.index.2, names_prefix="type.", values_from = type)
tidy_places <- spread %>%
left_join(types_wide, by="array.index") %>%
left_join(time_spent_wide, by="array.index") %>%
left_join(times_wide, by="array.index") %>% select(-c(array.index))
return(tidy_places)
}
tidy_places <- lapply(places_json, tidy_places_json)
bar <- as.data.frame(tidy_places[1])
View(bar)
View(bar)
debugSource('~/code/abm-poptimes/poptimes.R')
debugSource('~/code/abm-poptimes/poptimes.R')
debugSource('~/code/abm-poptimes/poptimes.R')
debugSource('~/code/abm-poptimes/poptimes.R')
print(type, types[i, "array.index.2"])
debugSource('~/code/abm-poptimes/poptimes.R')
debugSource('~/code/abm-poptimes/poptimes.R')
Q
Q
Q
Q
Q
